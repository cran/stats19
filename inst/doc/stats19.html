<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />

<meta name="author" content="R Lovelace, M Morgan, L Hama and M Padgham" />

<meta name="date" content="2024-02-08" />

<title>Introducing stats19</title>

<script>// Pandoc 2.9 adds attributes on both header and div. We remove the former (to
// be compatible with the behavior of Pandoc < 2.8).
document.addEventListener('DOMContentLoaded', function(e) {
  var hs = document.querySelectorAll("div.section[class*='level'] > :first-child");
  var i, h, a;
  for (i = 0; i < hs.length; i++) {
    h = hs[i];
    if (!/^h[1-6]$/i.test(h.tagName)) continue;  // it should be a header h1-h6
    a = h.attributes;
    while (a.length > 0) h.removeAttribute(a[0].name);
  }
});
</script>

<style type="text/css">
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
</style>



<style type="text/css">
code {
white-space: pre;
}
.sourceCode {
overflow: visible;
}
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
{ counter-reset: source-line 0; }
pre.numberSource code > span
{ position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
{ content: counter(source-line);
position: relative; left: -1em; text-align: right; vertical-align: baseline;
border: none; display: inline-block;
-webkit-touch-callout: none; -webkit-user-select: none;
-khtml-user-select: none; -moz-user-select: none;
-ms-user-select: none; user-select: none;
padding: 0 4px; width: 4em;
color: #aaaaaa;
}
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa; padding-left: 4px; }
div.sourceCode
{ }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } 
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.at { color: #7d9029; } 
code span.bn { color: #40a070; } 
code span.bu { color: #008000; } 
code span.cf { color: #007020; font-weight: bold; } 
code span.ch { color: #4070a0; } 
code span.cn { color: #880000; } 
code span.co { color: #60a0b0; font-style: italic; } 
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.do { color: #ba2121; font-style: italic; } 
code span.dt { color: #902000; } 
code span.dv { color: #40a070; } 
code span.er { color: #ff0000; font-weight: bold; } 
code span.ex { } 
code span.fl { color: #40a070; } 
code span.fu { color: #06287e; } 
code span.im { color: #008000; font-weight: bold; } 
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.kw { color: #007020; font-weight: bold; } 
code span.op { color: #666666; } 
code span.ot { color: #007020; } 
code span.pp { color: #bc7a00; } 
code span.sc { color: #4070a0; } 
code span.ss { color: #bb6688; } 
code span.st { color: #4070a0; } 
code span.va { color: #19177c; } 
code span.vs { color: #4070a0; } 
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } 
</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    var j = 0;
    while (j < rules.length) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") {
        j++;
        continue;
      }
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') {
        j++;
        continue;
      }
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>



<style type="text/css">

div.csl-bib-body { }
div.csl-entry {
clear: both;
}
.hanging div.csl-entry {
margin-left:2em;
text-indent:-2em;
}
div.csl-left-margin {
min-width:2em;
float:left;
}
div.csl-right-inline {
margin-left:2em;
padding-left:1em;
}
div.csl-indent {
margin-left: 2em;
}
</style>

<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">Introducing stats19</h1>
<h4 class="author">R Lovelace, M Morgan, L Hama and M Padgham</h4>
<h4 class="date">2024-02-08</h4>



<div id="introduction" class="section level2">
<h2>Introduction</h2>
<p><strong>stats19</strong> enables access to and processing of Great
Britain’s official road traffic casualty database, <a href="https://www.data.gov.uk/dataset/cb7ae6f0-4be6-4935-9277-47e5ce24a11f/road-safety-data">STATS19</a>.
A description of variables in the database can be found in a <a href="https://data.dft.gov.uk/road-accidents-safety-data/Brief-guide-to%20road-accidents-and-safety-data.doc">document</a>
provided by the UK’s Department for Transport (DfT). The datasets are
collectively called STATS19 after the form used to report them, which
can be found <a href="https://assets.publishing.service.gov.uk/government/uploads/system/uploads/attachment_data/file/995422/stats19.pdf">here</a>.
This vignette focuses on how to use the <strong>stats19</strong> package
to work with STATS19 data.</p>
<p><strong>Note</strong>: The Department for Transport used to refer to
‘accidents’, but “crashes” may be a more appropriate term, as emphasised
in the “crash not accident” arguments of road safety advocacy groups
such as <a href="https://www.roadpeace.org/get-involved/crash-not-accident/">RoadPeace</a>.
We use the term collision only in reference to nomenclature within the
data as provided.</p>
<p>The development version is hosted on <a href="https://github.com/ITSLeeds/stats19">GitHub</a> and can be
installed and loaded as follows:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="co"># from CRAN</span></span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">&quot;stats19&quot;</span>)</span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a><span class="co"># you can install the latest development (discoraged) using:</span></span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a>remotes<span class="sc">::</span><span class="fu">install_github</span>(<span class="st">&quot;ITSLeeds/stats19&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="fu">library</span>(stats19)</span></code></pre></div>
</div>
<div id="functions" class="section level2">
<h2>Functions</h2>
<p>The easiest way to get STATS19 data is with
<code>get_stats19()</code>. This function takes 2 main arguments,
<code>year</code> and <code>type</code>. The year can be any year
between 1979 and 202x where x is the current year minus one or two due
to the delay in publishing STATS19 statistics. The type can be one of
<code>accidents</code>, <code>casualties</code> and
<code>vehicles</code>, described below. <code>get_stats19()</code>
performs 3 jobs, corresponding to three main types of functions:</p>
<ul>
<li><p><strong>Download</strong>: A <code>dl_stats19()</code> function
accepts <code>year</code>, <code>type</code> and <code>filename</code>
arguments to make it easy to find the right file to download
only.</p></li>
<li><p><strong>Read</strong>: STATS19 data is provided in a particular
format that benefits from being read-in with pre-specified column types.
This is taken care of with <code>read_*()</code> functions providing
access to the 3 main tables in STATS19 data:</p>
<ul>
<li><code>read_collisions()</code> reads-in the crash data (which has
one row per incident)</li>
<li><code>read_casualties()</code> reads-in the casualty data (which has
one row per person injured or killed)</li>
<li><code>read_vehicles()</code> reads-in the vehicles table, which
contains information on the vehicles involved in the crashes (and has
one row per vehicle)</li>
</ul></li>
<li><p><strong>Format</strong>: There are corresponding
<code>format_*()</code> functions for each of the <code>read_*()</code>
functions. These have been exported for convenience, as the two sets of
functions are closely related, there is also a <code>format</code>
parameter for the <code>read_*()</code> functions, which by default is
<code>TRUE</code>, adds labels to the tables. The raw data provided by
the DfT contains only integers. Running
<code>read_*(..., format = TRUE)</code> converts these integer values to
the corresponding character variables for each of the three tables. For
example, <code>read_collisions(format = TRUE)</code> converts values in
the <code>accident_severity</code> column from <code>1</code>,
<code>2</code> and <code>3</code> to <code>Slight</code>,
<code>Serious</code> and <code>Fatal</code> using
<code>fromat_collisions()</code> function. To read-in raw data without
formatting, set <code>format = FALSE</code>.</p></li>
</ul>
<p>Multiple functions (<code>read_*</code> and <code>format_*</code>)
are needed for each step because of the structure of STATS19 data, which
are divided into 3 tables:</p>
<ol style="list-style-type: decimal">
<li>“accident circumstances, with details about location, severity,
weather, etc.;</li>
<li>casualties, referencing knowledge about the victims; and</li>
<li>vehicles, which contains more information about the vehicle type and
manoeuvres, as well the some information about the driver.”</li>
</ol>
<p>Data files containing multiple years worth of data can be downloaded.
Datasets since 1979 are broadly consistent, meaning that STATS19 data
represents a rich historic geographic record of road casualties at a
national level.</p>
</div>
<div id="download-stats19-data" class="section level2">
<h2>Download STATS19 data</h2>
<p><strong>stats19</strong> enables download of raw STATS19 data with
<code>dl_*</code> functions. The following code chunk, for example,
downloads and unzips a .zip file containing STATS19 data from 2022:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="fu">dl_stats19</span>(<span class="at">year =</span> <span class="dv">2022</span>, <span class="at">type =</span> <span class="st">&quot;collision&quot;</span>, <span class="at">ask =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<p>Note that in the previous command, <code>ask = FALSE</code>, meaning
you will not be asked. By default you are asked to confirm, before
downloading large files. Currently, these files are downloaded to a
default location of <code>tempdir</code> which is a platform independent
“safe” but temporary location to download the data in. Once downloaded,
they are unzipped under original DfT file names. The
<code>dl_stats19()</code> function prints out the location and final
file name(s) of unzipped files(s) as shown above.</p>
<p><code>dl_stats19()</code> takes three parameters. Supplying a
<code>file_name</code> is interpreted to mean that the user is aware of
what to download and the other two parameters will be ignored. You can
also use <code>year</code> and <code>type</code> to “search” through the
file names, which are stored in a lazy-loaded dataset called
<code>stats19::file_names</code>.</p>
<!-- In versions above `1.3.0`, function `dl_stats19()` behaves more like `get_stats19()`, that is parameter `type` is by default `accidents` and it can also download multiple years more efficiently. -->
<p>You can find out the names of files that can be downloaded with
<code>names(stats19::file_names)</code>, an example of which is shown
below:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a>stats19<span class="sc">::</span>file_names<span class="sc">$</span>DigitalBreathTestData2013.zip</span></code></pre></div>
<p>To see how <code>file_names</code> was created, see
<code>?file_names</code>. Data files from other years can be selected
interactively. Just providing a year, for example, presents the user
with multiple options (from <code>file_names</code>), illustrated
below:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a><span class="fu">dl_stats19</span>(<span class="at">year =</span> <span class="dv">2022</span>)</span></code></pre></div>
<pre><code>Multiple matches. Which do you want to download?

1: dft-road-casualty-statistics-casualty-2022.csv
2: dft-road-casualty-statistics-vehicle-2022.csv
3: dft-road-casualty-statistics-accident-2022.csv

Selection: 
Enter an item from the menu, or 0 to exit</code></pre>
<p>When R is running interactively, you can select which of the 3
matching files to download: those relating to vehicles, casualties or
accidents in 2022.</p>
</div>
<div id="read-stats19-data" class="section level2">
<h2>Read STATS19 data</h2>
<p>In a similar approach to the download section before, we can read
files downloaded using a <code>data_dir</code> location of the file and
the <code>filename</code> to read. The code below will download the
<code>dftRoadSafetyData_Accidents_2022.zip</code> file from the DfT
servers and read its content. Files are saved by default in
<code>tempdir()</code>, but this can be overridden to ensure permanent
storage in a user-defined location.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a>crashes_2022_raw <span class="ot">=</span> <span class="fu">get_stats19</span>(<span class="at">year =</span> <span class="dv">2022</span>, <span class="at">type =</span> <span class="st">&quot;collision&quot;</span>, <span class="at">format =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<p><strong>stats19</strong> imports data with
<code>readr::read_csv()</code> which results in a ‘tibble’ object: a
data frame with more user-friendly printing and a few other
features.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a><span class="fu">class</span>(crashes_2022_raw)</span>
<span id="cb8-2"><a href="#cb8-2" tabindex="-1"></a><span class="fu">dim</span>(crashes_2022_raw)</span></code></pre></div>
<p>There are three <code>read_*()</code> functions, corresponding to the
three different classes of data provided by the DfT: 1.
<code>read_collisions()</code> 2. <code>read_casualties()</code> 3.
<code>read_vehicles()</code></p>
<p>In all cases, a default parameter <code>read_*(format = TRUE)</code>
returns the data in formatted form, as described above. Data can also be
imported in the form directly provided by the DfT by passing
<code>format = FALSE</code>, and then subsequently formatted with
additional <code>format_*()</code> functions, as described in a final
section of this vignette. Each of these <code>read_*()</code> functions
is now described in more detail.</p>
<div id="crash-data" class="section level3">
<h3>Crash data</h3>
<p>After raw data files have been downloaded as described in the
previous section, they can then be read-in as follows:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a>crashes_2022_raw <span class="ot">=</span> <span class="fu">read_collisions</span>(<span class="at">year =</span> <span class="dv">2022</span>, <span class="at">format =</span> <span class="cn">FALSE</span>)</span>
<span id="cb9-2"><a href="#cb9-2" tabindex="-1"></a>crashes_2022 <span class="ot">=</span> <span class="fu">format_collisions</span>(crashes_2022_raw)</span>
<span id="cb9-3"><a href="#cb9-3" tabindex="-1"></a><span class="fu">nrow</span>(crashes_2022_raw)</span>
<span id="cb9-4"><a href="#cb9-4" tabindex="-1"></a><span class="fu">ncol</span>(crashes_2022_raw)</span>
<span id="cb9-5"><a href="#cb9-5" tabindex="-1"></a><span class="fu">nrow</span>(crashes_2022)</span>
<span id="cb9-6"><a href="#cb9-6" tabindex="-1"></a><span class="fu">ncol</span>(crashes_2022)</span></code></pre></div>
<p>What just happened? We read-in data on all road crashes recorded by
the police in 2022 across Great Britain. The dataset contains</p>
<p>32 columns (variables) for</p>
<p>129,982 crashes.</p>
<p>This work was done by <code>read_collisions(format = FALSE)</code>,
which imported the “raw” STATS19 data without cleaning messy column
names or re-categorising the outputs. <code>format_collisions()</code>
function automates the process of matching column names with variable
names and labels in a <a href="https://data.dft.gov.uk/road-accidents-safety-data/variable%20lookup.xls"><code>.xls</code>
file</a> provided by the DfT. This means <code>crashes_2022</code> is
much more usable than <code>crashes_2022_raw</code>, as shown below,
which shows some key variables in the messy and clean datasets:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a>crashes_2022_raw[<span class="fu">c</span>(<span class="dv">7</span>, <span class="dv">18</span>, <span class="dv">23</span>, <span class="dv">25</span>)]</span>
<span id="cb10-2"><a href="#cb10-2" tabindex="-1"></a>crashes_2022[<span class="fu">c</span>(<span class="dv">7</span>, <span class="dv">18</span>, <span class="dv">23</span>, <span class="dv">25</span>)]</span></code></pre></div>
<p>By default, <code>format = TRUE</code>, meaning that the two stages
of <code>read_collisions(format = FALSE)</code> and
<code>format_collisions()</code> yield the same result as
<code>read_collisions(format = TRUE)</code>. For the full list of
columns, run <code>names(crashes_2022)</code>.</p>
<!-- This means `crashes_2022` is much more usable than `crashes_2022_raw`, as shown below, which shows three records and some key variables in the messy and clean datasets: -->
<p><strong>Note</strong>: As indicated above, the term collision is only
used as directly provided by the DfT; “crashes” is a more appropriate
term, hence we call our resultant datasets <code>crashes_*</code>.</p>
</div>
</div>
<div id="format-stats19-data" class="section level2">
<h2>Format STATS19 data</h2>
<p>It is also possible to import the “raw” data as provided by the DfT.
A <a href="https://data.dft.gov.uk/road-accidents-safety-data/variable%20lookup.xls"><code>.xls</code>
file</a> provided by the DfT defines the column names for the datasets
provided. The packaged datasets <code>stats19_variables</code> and
<code>stats19_schema</code> provide summary information about the
contents of this data guide. These contain the full variable names in
the guide (<code>stats19_variables</code>) and a complete look up table
relating integer values to the <code>.csv</code> files provided by the
DfT and their labels (<code>stats19_schema</code>). The first rows of
each dataset are shown below:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" tabindex="-1"></a>stats19_variables</span>
<span id="cb11-2"><a href="#cb11-2" tabindex="-1"></a>stats19_schema</span></code></pre></div>
<p>The code that generated these small datasets can be found in their
help pages (accessed with <code>?stats19_variables</code> and
<code>?stats19_schema</code> respectively). <code>stats19_schema</code>
is used internally to automate the process of formatting the downloaded
<code>.csv</code> files. Column names are formatted by the function
<code>format_column_names()</code>, as illustrated below:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" tabindex="-1"></a><span class="fu">format_column_names</span>(stats19_variables<span class="sc">$</span>variable[<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>])</span></code></pre></div>
<p>Previous approaches to data formatting <code>STATS19</code> data
involved hard-coding results. This more automated approach to data
cleaning is more consistent and fail-safe. The three functions:
<code>format_collisions()</code>, <code>format_vehicles()</code> and
<code>format_casualties()</code> do the data formatting on the
respective data frames, as illustrated below:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" tabindex="-1"></a>crashes_2022 <span class="ot">=</span> <span class="fu">format_collisions</span>(crashes_2022_raw)</span>
<span id="cb13-2"><a href="#cb13-2" tabindex="-1"></a></span>
<span id="cb13-3"><a href="#cb13-3" tabindex="-1"></a><span class="co"># vehicle data for 2022</span></span>
<span id="cb13-4"><a href="#cb13-4" tabindex="-1"></a><span class="fu">dl_stats19</span>(<span class="at">year =</span> <span class="dv">2022</span>, <span class="at">type =</span> <span class="st">&quot;vehicle&quot;</span>, <span class="at">ask =</span> <span class="cn">FALSE</span>)</span>
<span id="cb13-5"><a href="#cb13-5" tabindex="-1"></a>vehicles_2022_raw <span class="ot">=</span> <span class="fu">read_vehicles</span>(<span class="at">year =</span> <span class="dv">2022</span>)</span>
<span id="cb13-6"><a href="#cb13-6" tabindex="-1"></a>vehicles_2022 <span class="ot">=</span> <span class="fu">format_vehicles</span>(vehicles_2022_raw)</span>
<span id="cb13-7"><a href="#cb13-7" tabindex="-1"></a></span>
<span id="cb13-8"><a href="#cb13-8" tabindex="-1"></a><span class="co"># casualties data for 2022</span></span>
<span id="cb13-9"><a href="#cb13-9" tabindex="-1"></a><span class="fu">dl_stats19</span>(<span class="at">year =</span> <span class="dv">2022</span>, <span class="at">type =</span> <span class="st">&quot;casualty&quot;</span>, <span class="at">ask =</span> <span class="cn">FALSE</span>)</span>
<span id="cb13-10"><a href="#cb13-10" tabindex="-1"></a>casualties_2022 <span class="ot">=</span> <span class="fu">read_casualties</span>(<span class="at">year =</span> <span class="dv">2022</span>)</span></code></pre></div>
<p>The package automates this two-step <code>read_*</code> and
<code>format_*</code> process by defaulting in all cases to
<code>data_year = read_*(year, format = TRUE)</code>.
<code>read_*</code> functions return, by default, formatted data. The
two-step process may nevertheless be important for reference to the
official nomenclature and values as provided by the DfT.</p>
<p>A summary of the outputs for each of the three tables is shown
below.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" tabindex="-1"></a>summarise_stats19 <span class="ot">=</span> <span class="cf">function</span>(x) {</span>
<span id="cb14-2"><a href="#cb14-2" tabindex="-1"></a>  <span class="fu">data.frame</span>(<span class="at">row.names =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(x),</span>
<span id="cb14-3"><a href="#cb14-3" tabindex="-1"></a>    <span class="at">name =</span> <span class="fu">substr</span>(<span class="fu">names</span>(x), <span class="dv">1</span>, <span class="dv">19</span>),</span>
<span id="cb14-4"><a href="#cb14-4" tabindex="-1"></a>    <span class="at">class =</span> <span class="fu">sapply</span>(x, <span class="cf">function</span>(v) <span class="fu">class</span>(v)[<span class="dv">1</span>]),</span>
<span id="cb14-5"><a href="#cb14-5" tabindex="-1"></a>    <span class="at">n_unique =</span> <span class="fu">sapply</span>(x, <span class="cf">function</span>(v) <span class="fu">length</span>(<span class="fu">unique</span>(v))),</span>
<span id="cb14-6"><a href="#cb14-6" tabindex="-1"></a>    <span class="at">first_label =</span> <span class="fu">sapply</span>(x, <span class="cf">function</span>(v) <span class="fu">substr</span>(<span class="fu">unique</span>(v)[<span class="dv">1</span>], <span class="dv">1</span>, <span class="dv">16</span>)),</span>
<span id="cb14-7"><a href="#cb14-7" tabindex="-1"></a>    <span class="at">most_common_value =</span> <span class="fu">sapply</span>(x, <span class="cf">function</span>(v) </span>
<span id="cb14-8"><a href="#cb14-8" tabindex="-1"></a>      <span class="fu">substr</span>(<span class="fu">names</span>(<span class="fu">sort</span>(<span class="fu">table</span>(v), <span class="at">decreasing =</span> <span class="cn">TRUE</span>)[<span class="dv">1</span>]), <span class="dv">1</span>, <span class="dv">16</span>)[<span class="dv">1</span>])</span>
<span id="cb14-9"><a href="#cb14-9" tabindex="-1"></a>  )</span>
<span id="cb14-10"><a href="#cb14-10" tabindex="-1"></a>}</span></code></pre></div>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(<span class="fu">summarise_stats19</span>(crashes_2022), </span>
<span id="cb15-2"><a href="#cb15-2" tabindex="-1"></a>             <span class="at">caption =</span> <span class="st">&quot;Summary of formatted crash data.&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(<span class="fu">summarise_stats19</span>(vehicles_2022), </span>
<span id="cb16-2"><a href="#cb16-2" tabindex="-1"></a>             <span class="at">caption =</span> <span class="st">&quot;Summary of formatted vehicles data.&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(<span class="fu">summarise_stats19</span>(casualties_2022), </span>
<span id="cb17-2"><a href="#cb17-2" tabindex="-1"></a>             <span class="at">caption =</span> <span class="st">&quot;Summary of formatted casualty data.&quot;</span>)</span></code></pre></div>
<p>For testing and other purposes, a sample from the accidents table is
provided in the package. A few columns from the two-row sample is shown
below:</p>
</div>
<div id="casualties-data" class="section level2">
<h2>Casualties data</h2>
<p>As with <code>crashes_2022</code>, casualty data for 2022 can be
downloaded, read-in and formatted as follows:</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" tabindex="-1"></a><span class="fu">dl_stats19</span>(<span class="at">year =</span> <span class="dv">2022</span>, <span class="at">type =</span> <span class="st">&quot;casualty&quot;</span>, <span class="at">ask =</span> <span class="cn">FALSE</span>)</span>
<span id="cb18-2"><a href="#cb18-2" tabindex="-1"></a>casualties_2022 <span class="ot">=</span> <span class="fu">read_casualties</span>(<span class="at">year =</span> <span class="dv">2022</span>)</span>
<span id="cb18-3"><a href="#cb18-3" tabindex="-1"></a><span class="fu">nrow</span>(casualties_2022)</span>
<span id="cb18-4"><a href="#cb18-4" tabindex="-1"></a><span class="fu">ncol</span>(casualties_2022)</span></code></pre></div>
<p>The results show that there were</p>
<p>170,993 casualties reported by the police in the STATS19 dataset in
2022, and</p>
<p>16 columns (variables). Values for a sample of these columns are
shown below:</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" tabindex="-1"></a>casualties_2022[<span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>, <span class="dv">14</span>)]</span></code></pre></div>
<p>The full list of column names in the <code>casualties</code> dataset
is:</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" tabindex="-1"></a><span class="fu">names</span>(casualties_2022)</span></code></pre></div>
</div>
<div id="vehicles-data" class="section level2">
<h2>Vehicles data</h2>
<p>Data for vehicles involved in crashes in 2022 can be downloaded,
read-in and formatted as follows:</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" tabindex="-1"></a><span class="fu">dl_stats19</span>(<span class="at">year =</span> <span class="dv">2022</span>, <span class="at">type =</span> <span class="st">&quot;vehicle&quot;</span>, <span class="at">ask =</span> <span class="cn">FALSE</span>)</span>
<span id="cb21-2"><a href="#cb21-2" tabindex="-1"></a>vehicles_2022 <span class="ot">=</span> <span class="fu">read_vehicles</span>(<span class="at">year =</span> <span class="dv">2022</span>)</span>
<span id="cb21-3"><a href="#cb21-3" tabindex="-1"></a><span class="fu">nrow</span>(vehicles_2022)</span>
<span id="cb21-4"><a href="#cb21-4" tabindex="-1"></a><span class="fu">ncol</span>(vehicles_2022)</span></code></pre></div>
<p>The results show that there were</p>
<p>238,926 vehicles involved in crashes reported by the police in the
STATS19 dataset in 2022, with</p>
<p>23 columns (variables). Values for a sample of these columns are
shown below:</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" tabindex="-1"></a>vehicles_2022[<span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">14</span><span class="sc">:</span><span class="dv">16</span>)]</span></code></pre></div>
<p>The full list of column names in the <code>vehicles</code> dataset
is:</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" tabindex="-1"></a><span class="fu">names</span>(vehicles_2022)</span></code></pre></div>
<!-- More data can be read-in as follows: -->
</div>
<div id="creating-geographic-crash-data" class="section level2">
<h2>Creating geographic crash data</h2>
<p>An important feature of STATS19 data is that the collision table
contains geographic coordinates. These are provided at ~10m resolution
in the UK’s official coordinate reference system (the Ordnance Survey
National Grid, EPSG code 27700). <strong>stats19</strong> converts the
non-geographic tables created by <code>format_collisions()</code> into
the geographic data form of the <a href="https://cran.r-project.org/package=sf"><code>sf</code> package</a>
with the function <code>format_sf()</code> as follows:</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" tabindex="-1"></a>crashes_sf <span class="ot">=</span> <span class="fu">format_sf</span>(crashes_2022)</span></code></pre></div>
<p>The note arises because <code>NA</code> values are not permitted in
<code>sf</code> coordinates, and so rows containing no coordinates are
automatically removed. Having the data in a standard geographic form
allows various geographic operations to be performed on it. Spatial
operations, such as spatial subsetting and spatial aggregation, can be
performed, to show the relationship between STATS19 data and other
geographic objects, such as roads, schools and administrative zones.</p>
<p>An example of an administrative zone dataset of relevance to STATS19
data is the boundaries of police forces in England, which is provided in
the packaged dataset <code>police_boundaries</code>. The following code
chunk demonstrates the kind of spatial operations that can be performed
on geographic STATS19 data, by counting and plotting the number of
fatalities per police force:</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" tabindex="-1"></a><span class="fu">library</span>(sf)</span>
<span id="cb25-2"><a href="#cb25-2" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb25-3"><a href="#cb25-3" tabindex="-1"></a>crashes_sf <span class="sc">%&gt;%</span> </span>
<span id="cb25-4"><a href="#cb25-4" tabindex="-1"></a>  <span class="fu">filter</span>(accident_severity <span class="sc">==</span> <span class="st">&quot;Fatal&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb25-5"><a href="#cb25-5" tabindex="-1"></a>  <span class="fu">select</span>(<span class="at">n_fatalities =</span> accident_index) <span class="sc">%&gt;%</span> </span>
<span id="cb25-6"><a href="#cb25-6" tabindex="-1"></a>  <span class="fu">aggregate</span>(<span class="at">by =</span> police_boundaries, <span class="at">FUN =</span> length) <span class="sc">%&gt;%</span> </span>
<span id="cb25-7"><a href="#cb25-7" tabindex="-1"></a>  <span class="fu">plot</span>()</span></code></pre></div>
<p>Of course, one should not draw conclusions from such analyses without
care. In this case, denominators are needed to infer anything about road
safety in any of the police regions. After suitable denominators have
been included, performance metrics such as ‘health risk’ (fatalities per
100,000 people), ‘traffic risk’ (fatalities per billion km, f/bkm) and
‘exposure risk’ (fatalities per million hours, f/mh) can be calculated
<span class="citation">(Feleke et al. 2018; Elvik et al.
2009)</span>.</p>
<p>The following code chunk, for example, returns all crashes within the
jurisdiction of <a href="https://en.wikipedia.org/wiki/West_Yorkshire_Police">West
Yorkshire Police</a>:</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" tabindex="-1"></a>west_yorkshire <span class="ot">=</span></span>
<span id="cb26-2"><a href="#cb26-2" tabindex="-1"></a>  police_boundaries[police_boundaries<span class="sc">$</span>pfa16nm <span class="sc">==</span> <span class="st">&quot;West Yorkshire&quot;</span>, ]</span></code></pre></div>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" tabindex="-1"></a>crashes_wy <span class="ot">=</span> crashes_sf[west_yorkshire, ]</span>
<span id="cb27-2"><a href="#cb27-2" tabindex="-1"></a><span class="fu">nrow</span>(crashes_sf)</span>
<span id="cb27-3"><a href="#cb27-3" tabindex="-1"></a><span class="fu">nrow</span>(crashes_wy)</span></code></pre></div>
<p>This subsetting has selected the</p>
<p>4,371 crashes which occurred in West Yorkshire.</p>
</div>
<div id="joining-tables" class="section level2">
<h2>Joining tables</h2>
<p>The three main tables we have just read-in can be joined by shared
key variables. This is demonstrated in the code chunk below, which
subsets all casualties that took place in West Yorkshire, and counts the
number of casualties by severity for each crash:</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" tabindex="-1"></a><span class="fu">library</span>(tidyr)</span>
<span id="cb28-2"><a href="#cb28-2" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb28-3"><a href="#cb28-3" tabindex="-1"></a>sel <span class="ot">=</span> casualties_2022<span class="sc">$</span>accident_index <span class="sc">%in%</span> crashes_wy<span class="sc">$</span>accident_index</span>
<span id="cb28-4"><a href="#cb28-4" tabindex="-1"></a>casualties_wy <span class="ot">=</span> casualties_2022[sel, ]</span>
<span id="cb28-5"><a href="#cb28-5" tabindex="-1"></a>cas_types <span class="ot">=</span> casualties_wy <span class="sc">%&gt;%</span> </span>
<span id="cb28-6"><a href="#cb28-6" tabindex="-1"></a>  <span class="fu">select</span>(accident_index, casualty_type) <span class="sc">%&gt;%</span> </span>
<span id="cb28-7"><a href="#cb28-7" tabindex="-1"></a>  <span class="fu">group_by</span>(accident_index) <span class="sc">%&gt;%</span> </span>
<span id="cb28-8"><a href="#cb28-8" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb28-9"><a href="#cb28-9" tabindex="-1"></a>    <span class="at">Total =</span> <span class="fu">n</span>(),</span>
<span id="cb28-10"><a href="#cb28-10" tabindex="-1"></a>    <span class="at">walking =</span> <span class="fu">sum</span>(casualty_type <span class="sc">==</span> <span class="st">&quot;Pedestrian&quot;</span>),</span>
<span id="cb28-11"><a href="#cb28-11" tabindex="-1"></a>    <span class="at">cycling =</span> <span class="fu">sum</span>(casualty_type <span class="sc">==</span> <span class="st">&quot;Cyclist&quot;</span>),</span>
<span id="cb28-12"><a href="#cb28-12" tabindex="-1"></a>    <span class="at">passenger =</span> <span class="fu">sum</span>(casualty_type <span class="sc">==</span> <span class="st">&quot;Car occupant&quot;</span>)</span>
<span id="cb28-13"><a href="#cb28-13" tabindex="-1"></a>    ) </span>
<span id="cb28-14"><a href="#cb28-14" tabindex="-1"></a>cj <span class="ot">=</span> <span class="fu">left_join</span>(crashes_wy, cas_types)</span></code></pre></div>
<p>What just happened? We found the subset of casualties that took place
in West Yorkshire with reference to the <code>accident_index</code>
variable. Then we used the <strong>dplyr</strong> function
<code>summarise()</code>, to find the number of people who were in a
car, cycling, and walking when they were injured. This new casualty
dataset is joined onto the <code>crashes_wy</code> dataset. The result
is a spatial (<code>sf</code>) data frame of crashes in West Yorkshire,
with columns counting how many road users of different types were hurt.
The joined data has additional variables:</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" tabindex="-1"></a>base<span class="sc">::</span><span class="fu">setdiff</span>(<span class="fu">names</span>(cj), <span class="fu">names</span>(crashes_wy))</span></code></pre></div>
<p>As a simple spatial plot, we can map all the crashes that have
happened in West Yorkshire in 2022, with the colour related to the total
number of people hurt in each crash. Placing this plot next to a map of
West Yorkshire provides context:</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" tabindex="-1"></a><span class="fu">plot</span>(</span>
<span id="cb30-2"><a href="#cb30-2" tabindex="-1"></a>  cj[cj<span class="sc">$</span>cycling <span class="sc">&gt;</span> <span class="dv">0</span>, <span class="st">&quot;speed_limit&quot;</span>, ],</span>
<span id="cb30-3"><a href="#cb30-3" tabindex="-1"></a>  <span class="at">cex =</span> cj<span class="sc">$</span>Total[cj<span class="sc">$</span>cycling <span class="sc">&gt;</span> <span class="dv">0</span>] <span class="sc">/</span> <span class="dv">3</span>,</span>
<span id="cb30-4"><a href="#cb30-4" tabindex="-1"></a>  <span class="at">main =</span> <span class="st">&quot;Speed limit (cycling)&quot;</span></span>
<span id="cb30-5"><a href="#cb30-5" tabindex="-1"></a>  )</span>
<span id="cb30-6"><a href="#cb30-6" tabindex="-1"></a><span class="fu">plot</span>(</span>
<span id="cb30-7"><a href="#cb30-7" tabindex="-1"></a>  cj[cj<span class="sc">$</span>passenger <span class="sc">&gt;</span> <span class="dv">0</span>, <span class="st">&quot;speed_limit&quot;</span>, ],</span>
<span id="cb30-8"><a href="#cb30-8" tabindex="-1"></a>  <span class="at">cex =</span> cj<span class="sc">$</span>Total[cj<span class="sc">$</span>passenger <span class="sc">&gt;</span> <span class="dv">0</span>] <span class="sc">/</span> <span class="dv">3</span>,</span>
<span id="cb30-9"><a href="#cb30-9" tabindex="-1"></a>  <span class="at">main =</span> <span class="st">&quot;Speed limit (passenger)&quot;</span></span>
<span id="cb30-10"><a href="#cb30-10" tabindex="-1"></a>  )</span></code></pre></div>
<p>The spatial distribution of crashes in West Yorkshire clearly relates
to the region’s geography. Car crashes tend to happen on fast roads,
including busy Motorway roads, displayed in yellow above. Cycling is as
an urban activity, and the most bike crashes can be found in near Leeds
city centre, which has a comparatively high level of cycling (compared
with the low baseline of 3%). This can be seen by comparing the previous
map with an overview of the area, from an academic paper on the social,
spatial and temporal distribution of bike crashes <span class="citation">(Lovelace, Roberts, and Kellar 2016)</span>:</p>
<p>In addition to the <code>Total</code> number of people hurt/killed,
<code>cj</code> contains a column for each type of casualty (cyclist,
car occupant, etc.), and a number corresponding to the number of each
type hurt in each crash. It also contains the <code>geometry</code>
column from <code>crashes_sf</code>. In other words, joins allow the
casualties and vehicles tables to be geo-referenced. We can then explore
the spatial distribution of different casualty types. The following
figure, for example, shows the spatial distribution of pedestrians and
car passengers hurt in car crashes across West Yorkshire in 2022:</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb31-2"><a href="#cb31-2" tabindex="-1"></a>crashes_types <span class="ot">=</span> cj <span class="sc">%&gt;%</span> </span>
<span id="cb31-3"><a href="#cb31-3" tabindex="-1"></a>  <span class="fu">filter</span>(accident_severity <span class="sc">!=</span> <span class="st">&quot;Slight&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb31-4"><a href="#cb31-4" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">type =</span> <span class="fu">case_when</span>(</span>
<span id="cb31-5"><a href="#cb31-5" tabindex="-1"></a>    walking <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">~</span> <span class="st">&quot;Walking&quot;</span>,</span>
<span id="cb31-6"><a href="#cb31-6" tabindex="-1"></a>    cycling <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">~</span> <span class="st">&quot;Cycling&quot;</span>,</span>
<span id="cb31-7"><a href="#cb31-7" tabindex="-1"></a>    passenger <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">~</span> <span class="st">&quot;Passenger&quot;</span>,</span>
<span id="cb31-8"><a href="#cb31-8" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">&quot;Other&quot;</span></span>
<span id="cb31-9"><a href="#cb31-9" tabindex="-1"></a>  ))</span>
<span id="cb31-10"><a href="#cb31-10" tabindex="-1"></a><span class="fu">table</span>(crashes_types<span class="sc">$</span>speed_limit)</span>
<span id="cb31-11"><a href="#cb31-11" tabindex="-1"></a><span class="fu">ggplot</span>(crashes_types, <span class="fu">aes</span>(<span class="at">size =</span> Total, <span class="at">colour =</span> speed_limit)) <span class="sc">+</span></span>
<span id="cb31-12"><a href="#cb31-12" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">show.legend =</span> <span class="st">&quot;point&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb31-13"><a href="#cb31-13" tabindex="-1"></a>  <span class="fu">facet_grid</span>(<span class="fu">vars</span>(type), <span class="fu">vars</span>(accident_severity)) <span class="sc">+</span></span>
<span id="cb31-14"><a href="#cb31-14" tabindex="-1"></a>  <span class="fu">scale_size</span>(</span>
<span id="cb31-15"><a href="#cb31-15" tabindex="-1"></a>    <span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, <span class="dv">12</span>),</span>
<span id="cb31-16"><a href="#cb31-16" tabindex="-1"></a>    <span class="at">labels =</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>, <span class="st">&quot;3+&quot;</span>, <span class="dv">12</span>)</span>
<span id="cb31-17"><a href="#cb31-17" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb31-18"><a href="#cb31-18" tabindex="-1"></a>  <span class="fu">scale_color_gradientn</span>(<span class="at">colours =</span> <span class="fu">c</span>(<span class="st">&quot;blue&quot;</span>, <span class="st">&quot;yellow&quot;</span>, <span class="st">&quot;red&quot;</span>)) <span class="sc">+</span></span>
<span id="cb31-19"><a href="#cb31-19" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text =</span> <span class="fu">element_blank</span>(), <span class="at">axis.ticks =</span> <span class="fu">element_blank</span>())</span></code></pre></div>
<p>It is clear that different types of road users tend to get hurt in
different places. Car occupant casualties (labelled ‘passengers’ in the
map above), for example, are comparatively common on the outskirts of
cities such as Leeds, where speed limits tend to be higher and where
there are comparatively higher volumes of motor traffic. Casualties to
people on foot tend to happen in the city centres. That is not to say
that cities centres are more dangerous per unit distance (typically
casualties per billion kilometres, bkm, is the unit used) walked: there
is more walking in city centres (you need a denominator to estimate
risk).</p>
<p>To drill down further, we can find the spatial distribution of all
pedestrian casualties, broken-down by seriousness of casualty, and light
conditions. This can be done with <strong>tidyvers</strong> functions
follows:</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" tabindex="-1"></a><span class="fu">table</span>(cj<span class="sc">$</span>light_conditions)</span>
<span id="cb32-2"><a href="#cb32-2" tabindex="-1"></a>cj <span class="sc">%&gt;%</span> </span>
<span id="cb32-3"><a href="#cb32-3" tabindex="-1"></a>  <span class="fu">filter</span>(walking <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb32-4"><a href="#cb32-4" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">light =</span> <span class="fu">case_when</span>(</span>
<span id="cb32-5"><a href="#cb32-5" tabindex="-1"></a>    light_conditions <span class="sc">==</span> <span class="st">&quot;Daylight&quot;</span> <span class="sc">~</span> <span class="st">&quot;Daylight&quot;</span>,</span>
<span id="cb32-6"><a href="#cb32-6" tabindex="-1"></a>    light_conditions <span class="sc">==</span> <span class="st">&quot;Darkness - lights lit&quot;</span> <span class="sc">~</span> <span class="st">&quot;Lit&quot;</span>,</span>
<span id="cb32-7"><a href="#cb32-7" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">&quot;Other/Unlit&quot;</span></span>
<span id="cb32-8"><a href="#cb32-8" tabindex="-1"></a>  )) <span class="sc">%&gt;%</span> </span>
<span id="cb32-9"><a href="#cb32-9" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">colour =</span> speed_limit)) <span class="sc">+</span></span>
<span id="cb32-10"><a href="#cb32-10" tabindex="-1"></a>  <span class="fu">geom_sf</span>() <span class="sc">+</span></span>
<span id="cb32-11"><a href="#cb32-11" tabindex="-1"></a>  <span class="fu">facet_grid</span>(<span class="fu">vars</span>(light), <span class="fu">vars</span>(accident_severity)) <span class="sc">+</span></span>
<span id="cb32-12"><a href="#cb32-12" tabindex="-1"></a>  <span class="fu">scale_color_continuous</span>(<span class="at">low =</span> <span class="st">&quot;blue&quot;</span>, <span class="at">high =</span> <span class="st">&quot;red&quot;</span>) <span class="sc">+</span></span>
<span id="cb32-13"><a href="#cb32-13" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text =</span> <span class="fu">element_blank</span>(), <span class="at">axis.ticks =</span> <span class="fu">element_blank</span>())</span></code></pre></div>
<!-- These figures show the issue of pedestrian casualties in Leeds and Bradford city centres, which both have busy roads going through or around popular shopping and other destinations. -->
</div>
<div id="time-series-analysis" class="section level2">
<h2>Time series analysis</h2>
<p>We can also explore seasonal and daily trends in crashes by
aggregating crashes by day of the year:</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" tabindex="-1"></a>crashes_dates <span class="ot">=</span> cj <span class="sc">%&gt;%</span> </span>
<span id="cb33-2"><a href="#cb33-2" tabindex="-1"></a>  <span class="fu">st_set_geometry</span>(<span class="cn">NULL</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb33-3"><a href="#cb33-3" tabindex="-1"></a>  <span class="fu">group_by</span>(date) <span class="sc">%&gt;%</span> </span>
<span id="cb33-4"><a href="#cb33-4" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb33-5"><a href="#cb33-5" tabindex="-1"></a>    <span class="at">walking =</span> <span class="fu">sum</span>(walking),</span>
<span id="cb33-6"><a href="#cb33-6" tabindex="-1"></a>    <span class="at">cycling =</span> <span class="fu">sum</span>(cycling),</span>
<span id="cb33-7"><a href="#cb33-7" tabindex="-1"></a>    <span class="at">passenger =</span> <span class="fu">sum</span>(passenger)</span>
<span id="cb33-8"><a href="#cb33-8" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> </span>
<span id="cb33-9"><a href="#cb33-9" tabindex="-1"></a>  <span class="fu">gather</span>(mode, casualties, <span class="sc">-</span>date)</span>
<span id="cb33-10"><a href="#cb33-10" tabindex="-1"></a><span class="fu">ggplot</span>(crashes_dates, <span class="fu">aes</span>(date, casualties)) <span class="sc">+</span></span>
<span id="cb33-11"><a href="#cb33-11" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="fu">aes</span>(<span class="at">colour =</span> mode), <span class="at">method =</span> <span class="st">&quot;loess&quot;</span>) <span class="sc">+</span></span>
<span id="cb33-12"><a href="#cb33-12" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;Casualties per day&quot;</span>)</span></code></pre></div>
<p>Different types of crashes also tend to happen at different times of
day. This is illustrated in the plot below, which shows the times of day
when people who were travelling by different modes were most commonly
injured.</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" tabindex="-1"></a><span class="fu">library</span>(stringr)</span>
<span id="cb34-2"><a href="#cb34-2" tabindex="-1"></a></span>
<span id="cb34-3"><a href="#cb34-3" tabindex="-1"></a>crash_times <span class="ot">=</span> cj <span class="sc">%&gt;%</span> </span>
<span id="cb34-4"><a href="#cb34-4" tabindex="-1"></a>  <span class="fu">st_set_geometry</span>(<span class="cn">NULL</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb34-5"><a href="#cb34-5" tabindex="-1"></a>  <span class="fu">group_by</span>(<span class="at">hour =</span> <span class="fu">as.numeric</span>(<span class="fu">str_sub</span>(time, <span class="dv">1</span>, <span class="dv">2</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb34-6"><a href="#cb34-6" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb34-7"><a href="#cb34-7" tabindex="-1"></a>    <span class="at">walking =</span> <span class="fu">sum</span>(walking),</span>
<span id="cb34-8"><a href="#cb34-8" tabindex="-1"></a>    <span class="at">cycling =</span> <span class="fu">sum</span>(cycling),</span>
<span id="cb34-9"><a href="#cb34-9" tabindex="-1"></a>    <span class="at">passenger =</span> <span class="fu">sum</span>(passenger)</span>
<span id="cb34-10"><a href="#cb34-10" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> </span>
<span id="cb34-11"><a href="#cb34-11" tabindex="-1"></a>  <span class="fu">gather</span>(mode, casualties, <span class="sc">-</span>hour)</span>
<span id="cb34-12"><a href="#cb34-12" tabindex="-1"></a></span>
<span id="cb34-13"><a href="#cb34-13" tabindex="-1"></a><span class="fu">ggplot</span>(crash_times, <span class="fu">aes</span>(hour, casualties)) <span class="sc">+</span></span>
<span id="cb34-14"><a href="#cb34-14" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">colour =</span> mode))</span></code></pre></div>
<p>Note that bike crashes tend to have distinct morning and afternoon
peaks, in-line with previous research <span class="citation">(Lovelace,
Roberts, and Kellar 2016)</span>. A disproportionate number of car
crashes appear to happen in the afternoon.</p>
</div>
<div id="further-work" class="section level2">
<h2>Further work</h2>
<p>There is much potential to extend the package beyond downloading,
reading and formatting STATS19 data. The greatest potential is to
provide functions that will help with analysis of STATS19 data, to help
with road safety research. Much academic research has been done using
the data, a few examples of which are highlighted below to demonstrate
the wide potential for further work.</p>
<ul>
<li>Research exploring the effectiveness of road safety policies such as
speed limits. An example in this area is this <a href="https://pubmed.ncbi.nlm.nih.gov/20007666/">paper on 20 mph
zones</a> who found that areas with 20mph speed limits were safer. This
raises the question: can the same result be repeated using reproducible
methods? Does the finding hold for more recent 20 mph zones? Is the
recent finding of the Department for Transport’s (<a href="https://www.gov.uk/government/publications/20-mph-speed-limits-on-roads">2018</a>)
research, that 20 mph zones alone do not reduce crash rates, supported
by reproducible analysis? What are the factors that make speed limits
more or less effective <span class="citation">(see
<strong>sarkar_street_2018?</strong> for example)</span>?</li>
<li>Research into weather as a contributing factor to road traffic
casualties <span class="citation">(e.g. Edwards 1998)</span>. This
raises the question: could matching crash data from the STATS19 data
with historic weather data from other R packages help advance knowledge
in this area?</li>
<li>Assessment of crash rates normalised by estimated exposure rates
(risk). An example of this type of research by an author of the package
found substantial spatial variation in the number of cyclist casualties
across West Yorkshire <span class="citation">(Lovelace, Roberts, and
Kellar 2016)</span>. This raises the questions: are similar spatial
differences found in other regions? What are the factors leading to
relatively high and low rates of different types of crash?</li>
</ul>
<p>The broader point is that the <strong>stats19</strong> package could
help road safety research, by making open access data on road crashes
more accessible to researchers worldwide. By easing the data download
and cleaning stages of research, it could also encourage reproducible
analysis in the field.</p>
<p>There is great potential to add value to and gain insight from the
data by joining the datasets with open data, for example from the
Consumer Data Research Centre (<a href="https://www.cdrc.ac.uk/">CDRC</a>, which funded this research),
OpenStreetMap and the UK’s Ordnance Survey. If you have any suggestions
on priorities for these future directions of (hopefully safe) travel,
please get in touch on at <a href="https://github.com/ITSLeeds/stats19/issues">github.com/ITSLeeds/stats19/issues</a>.</p>
</div>
<div id="references" class="section level2 unnumbered">
<h2 class="unnumbered">References</h2>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-edwards_relationship_1998" class="csl-entry">
Edwards, Julia B. 1998. <span>“The <span>Relationship Between Road
Accident Severity</span> and <span>Recorded Weather</span>.”</span>
<em>Journal of Safety Research</em> 29 (4): 249–62. <a href="https://doi.org/10.1016/S0022-4375(98)00051-6">https://doi.org/10.1016/S0022-4375(98)00051-6</a>.
</div>
<div id="ref-elvik_handbook_2009" class="csl-entry">
Elvik, Rune, Truls Vaa, Alena Erke, and Michael Sorensen. 2009. <em>The
Handbook of Road Safety Measures</em>. <span>Emerald Group
Publishing</span>.
</div>
<div id="ref-feleke_comparative_2018" class="csl-entry">
Feleke, Robel, Shaun Scholes, Malcolm Wardlaw, and Jennifer S. Mindell.
2018. <span>“Comparative Fatality Risk for Different Travel Modes by
Age, Sex, and Deprivation.”</span> <em>Journal of Transport &amp;
Health</em> 8 (March): 307–20. <a href="https://doi.org/10.1016/j.jth.2017.08.007">https://doi.org/10.1016/j.jth.2017.08.007</a>.
</div>
<div id="ref-lovelace_who_2016" class="csl-entry">
Lovelace, Robin, Hannah Roberts, and Ian Kellar. 2016. <span>“Who,
Where, When: The Demographic and Geographic Distribution of Bicycle
Crashes in <span>West Yorkshire</span>.”</span> <em>Transportation
Research Part F: Traffic Psychology and Behaviour</em>, Bicycling and
bicycle safety, 41, Part B. <a href="https://doi.org/10.1016/j.trf.2015.02.010">https://doi.org/10.1016/j.trf.2015.02.010</a>.
</div>
</div>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
